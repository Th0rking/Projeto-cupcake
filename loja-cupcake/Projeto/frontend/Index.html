<!DOCTYPE html>
<html>
<head>
  <title>Loja Cupcake Frontend</title>
</head>
<body>
  <h1>Loja Cupcake</h1>

  <h2>Registrar usuário</h2>
  <input id="reg_nome" placeholder="Nome" />
  <input id="reg_email" placeholder="Email" />
  <input id="reg_cpf" placeholder="CPF" />
  <input id="reg_telefone" placeholder="Telefone" />
  <input id="reg_senha" placeholder="Senha" type="password" />
  <button onclick="registrar()">Registrar</button>
  <div id="reg_msg"></div>

  <h2>Login</h2>
  <input id="login_email" placeholder="Email" />
  <input id="login_senha" placeholder="Senha" type="password" />
  <button onclick="login()">Entrar</button>
  <button onclick="logout()">Sair</button>
  <div id="login_msg"></div>

  <h2>Produtos</h2>
  <button onclick="listarProdutos()">Listar Produtos</button>
  <ul id="lista_produtos"></ul>

  <h3>Criar Produto</h3>
  <input id="prod_nome" placeholder="Nome do Produto" />
  <input id="prod_preco" placeholder="Preço" type="number" step="0.01" />
  <button onclick="criarProduto()">Criar</button>
  <div id="prod_msg"></div>

<script>
  async function registrar() {
    const res = await fetch('http://127.0.0.1:5000/register', {
      method: 'POST',
      headers: {'Content-Type': 'application/json'},
      body: JSON.stringify({
        nome: document.getElementById('reg_nome').value,
        email: document.getElementById('reg_email').value,
        cpf: document.getElementById('reg_cpf').value,
        telefone: document.getElementById('reg_telefone').value,
        senha: document.getElementById('reg_senha').value
      })
    });
    const data = await res.json();
    document.getElementById('reg_msg').textContent = data.mensagem || data.erro || 'Usuário registrado!';
  }

  async function login() {
    const res = await fetch('http://127.0.0.1:5000/login', {
      method: 'POST',
      headers: {'Content-Type': 'application/json'},
      credentials: 'include', // importante para enviar cookies de sessão
      body: JSON.stringify({
        email: document.getElementById('login_email').value,
        senha: document.getElementById('login_senha').value
      })
    });
    const data = await res.json();
    document.getElementById('login_msg').textContent = data.mensagem || data.erro;
  }

  async function logout() {
    const res = await fetch('http://127.0.0.1:5000/logout', {
      credentials: 'include'
    });
    const data = await res.json();
    document.getElementById('login_msg').textContent = data.mensagem;
  }

  async function listarProdutos() {
    const res = await fetch('http://127.0.0.1:5000/produtos', {
      credentials: 'include'
    });
    if(res.status === 401) {
      alert('Faça login para ver os produtos!');
      return;
    }
    const produtos = await res.json();
    const lista = document.getElementById('lista_produtos');
    lista.innerHTML = '';
    produtos.forEach(p => {
      const li = document.createElement('li');
      li.textContent = `${p.nome} - R$ ${p.preco.toFixed(2)}`;
      lista.appendChild(li);
    });
  }

  async function criarProduto() {
    const nome = document.getElementById('prod_nome').value;
    const preco = parseFloat(document.getElementById('prod_preco').value);
    const res = await fetch('http://127.0.0.1:5000/produtos', {
      method: 'POST',
      headers: {'Content-Type': 'application/json'},
      credentials: 'include',
      body: JSON.stringify({nome, preco})
    });
    const data = await res.json();
    document.getElementById('prod_msg').textContent = data.mensagem || 'Produto criado: ' + (data.nome || '');
  }
</script>
</body>
</html>
